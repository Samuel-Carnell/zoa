!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("zod"),require("@asteasolutions/zod-to-openapi"),require("@koa/router"),require("raw-body")):"function"==typeof define&&define.amd?define(["exports","zod","@asteasolutions/zod-to-openapi","@koa/router","raw-body"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@samuelcarnell/koa"]={},e.zod,e.zodToOpenapi,e.KoaRouter,e.rawBody)}(this,(function(e,t,r,o,n){"use strict";function s(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var i=s(t);r.extendZodWithOpenApi(i);class a{constructor(e){this._endpoint=e}response(e,t){const r=void 0!==t?[e,t]:[e];return this._endpoint.response.push(r),this}query(e){return this._endpoint.query=e,this}handler(e){this._endpoint.handler=e}summary(e){return this._endpoint.summary=e,this}description(e){return this._endpoint.description=e,this}tag(e){return this._endpoint.tags.push(e),this}body(e){return this._endpoint.request.body=e,this}build(){return[this._endpoint]}}function u(e){return{path:{value:e.path.value,parameters:Object.assign({},e.path.parameters)},tags:[...e.tags],middleware:[...e.middleware]}}class p{constructor(e){this._route=e,this._endpointBuilders=[]}use(e){var t;return null===(t=this._route.middleware)||void 0===t||t.push(e),this}path(e,t){const r=u(this._route);var o,n;r.path.value=(o=this._route.path.value,n=e,(o.endsWith("/")?o.slice(0,-1):o)+"/"+(n.startsWith("/")?n.slice(1):n)),r.path.parameters=Object.assign(Object.assign({},this._route.path.parameters),t);const s=new p(r);return this._endpointBuilders.push(s),s}tag(e){return this._route.tags.push(e),this}endpoint(e){const t=Object.assign(Object.assign({},u(this._route)),{method:e,request:{},query:{},response:[],summary:"",description:""}),r=new a(t);return this._endpointBuilders.push(r),r}build(){return this._endpointBuilders.flatMap((e=>e.build()))}}function d(e,t,r,o){return new(r||(r=Promise))((function(n,s){function i(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}u((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;function c(e,t,r,o){e.status=parseInt(t),void 0!==o&&(e.body=o,e.append("content-type",r))}function l(e,t){const r=[...e.middleware,(e,t)=>{e._internalRequest={},t()}];var o,s,a;Object.entries(e.path.parameters).length>0&&r.push((o=e.path.parameters,(e,t)=>{const r=[],n=i.object(o).safeParse(e.params);if(!n.success)for(const e of n.error.errors)r.push({name:e.path[0],message:e.message});if(!(r.length>0))return e._internalRequest.path=e.params,t();c(e.response,"422","application/problem+json",{type:"https://tools.ietf.org/html/rfc7231#section-6.5.1",title:"Path contained one or more validation errors.",status:422,errors:r})})),void 0!==e.query&&r.push((s=e.query,(e,t)=>{const r=[],o=i.object(s).safeParse(e.query);if(!o.success)for(const e of o.error.errors)r.push({name:e.path[0],message:e.message});if(!(r.length>0))return e._internalRequest.query=e.query,t();c(e.response,"422","application/problem+json",{type:"https://tools.ietf.org/html/rfc7231#section-6.5.1",title:"Query contained one or more validation errors.",status:422,errors:r})})),void 0!==e.request.body&&r.push((a=e.request.body,(e,t)=>d(void 0,void 0,void 0,(function*(){let r;const o=yield n(e.request.req).then((e=>e.toString()));try{r=JSON.parse(o)}catch(t){return void c(e.response,"422","application/problem+json",{type:"https://tools.ietf.org/html/rfc7231#section-6.5.1",title:"Malformed request body.",status:400,detail:"Request body contains invalid JSON."})}const s=[],i=a.safeParse(r);if(!i.success)for(const e of i.error.errors)s.push({name:e.path.join("."),message:e.message});if(!(s.length>0))return e._internalRequest.body=r,t();c(e.response,"422","application/problem+json",{type:"https://tools.ietf.org/html/rfc7231#section-6.5.1",title:"Body contained one or more validation errors.",status:422,errors:s})}))));t[e.method.toLowerCase()](e.path.value,...r,(t=>{if(void 0===e.handler)return void(t.response.status=503);const[r,o]=e.handler(Object.assign(Object.assign({},t.request),{endpoint:e,path:t._internalRequest.path,query:t._internalRequest.query,body:t._internalRequest.body}));c(t.response,r,"application/json",o)}))}const h={202:"Accepted",502:"Bad Gateway",400:"Bad Request",409:"Conflict",100:"Continue",201:"Created",417:"Expectation Failed",424:"Failed Dependency",403:"Forbidden",504:"Gateway Timeout",410:"Gone",505:"HTTP Version Not Supported",418:"I'm a teapot",419:"Insufficient Space on Resource",507:"Insufficient Storage",500:"Internal Server Error",411:"Length Required",423:"Locked",420:"Method Failure",405:"Method Not Allowed",301:"Moved Permanently",302:"Moved Temporarily",207:"Multi-Status",300:"Multiple Choices",511:"Network Authentication Required",204:"No Content",203:"Non Authoritative Information",406:"Not Acceptable",404:"Not Found",501:"Not Implemented",304:"Not Modified",200:"OK",206:"Partial Content",402:"Payment Required",308:"Permanent Redirect",412:"Precondition Failed",428:"Precondition Required",102:"Processing",103:"Early Hints",426:"Upgrade Required",407:"Proxy Authentication Required",431:"Request Header Fields Too Large",408:"Request Timeout",413:"Request Entity Too Large",414:"Request-URI Too Long",416:"Requested Range Not Satisfiable",205:"Reset Content",303:"See Other",503:"Service Unavailable",101:"Switching Protocols",307:"Temporary Redirect",429:"Too Many Requests",401:"Unauthorized",451:"Unavailable For Legal Reasons",422:"Unprocessable Entity",415:"Unsupported Media Type",305:"Use Proxy",421:"Misdirected Request"};function f(e,t){var r;t.registerPath({path:(r=e.path.value,r.split("/").map((e=>e.startsWith(":")?`{${e.slice(1)}}`:e)).join("/")),method:e.method.toLowerCase(),tags:e.tags,request:{params:i.object(e.path.parameters),query:i.object(e.query)},responses:e.response.reduce(((e,t)=>{const[r,o]=t,n=void 0!==o?{"application/json":{schema:o}}:void 0;var s;return e[r]={description:(s=r,h[s]),content:n},e}),{})})}e.App=class extends p{constructor(){super({path:{value:"/",parameters:{}},middleware:[],tags:[]})}get endpoints(){return void 0!==this._endpointsCache||(this._endpointsCache=this.build()),this._endpointsCache}middleware(){const e=new o;for(const t of this.endpoints)l(t,e);return e.middleware()}openApiDocument(e){const t=new r.OpenAPIRegistry;for(const e of this.endpoints)f(e,t);return new r.OpenApiGeneratorV3(t.definitions).generateDocument({openapi:"3.0.0",info:e})}}}));
//# sourceMappingURL=index.umd.js.map
